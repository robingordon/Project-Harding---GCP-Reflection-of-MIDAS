--------------------------------------------------------------------------------
--
-- file-name    : cdslm10040.sql
-- author       : Ross MacLean
-- date created : 27th May 2015
--
--------------------------------------------------------------------------------
-- Description  : This script is for the first 3 steps of processing sales mart
--                data
--
-- Comments     : This replaces the old Sales Mart in EXN_DW_DB as part of CR27
--
-- Usage        : NZSQL Call
--
-- Called By    : CDSLM10000.scr
--
-- Calls        : None
--
-- Parameters   : N/A
--
-- Exit codes   : 0 - Success
--                1 - Failure
--
-- Revisions
-- ====================================================================================
-- Date     user id  MR#           Comments                                       Ver.
-- ------   -------  ------------  ---------------------------------------        ----
-- 270515   ROM19    CR27          Initial version                                1.0
-- 120216   AWH01    STSengineers  New CASE statements                            2.0
-- 110816   NSA19    Mobile        Add column types 61 to 70                      2.1 
-- 101116   PPA01    Digital/NowTV Amend population of RTM columns                2.2
-- 210617   FHU35    Lima          Add column types 71 to 90                      2.3 
-- 210817   NSA19    Lima          For RTM_LEVEL_2 and RTM_LEVEL_3, include       2.4 
--                                 'interactive-gateway' and 
--                                 'ordermanagement' under Red Button and Online 
--                                 respectively.        
-- 211217   cdn10    INC2298803    Fix On Fail for digitaltrading_shop user       2.5
-- 080218   PPA01    ASM/IHOB      Added RTM cases for Asynchronous Messaging &   2.6
--                                 In-House Outbound.
-- 130318   aca30    NWAR          Added RTM cases for 'sky-services'             2.7
-- 250919   ANP52    GCP           Update for migration to BQ					  3.0
--------------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--Populate td_order_product_p5 - Join out to get DAY_SK and ID from BSBCONTACTOR
--via the PARTY_ROLE route. 
--------------------------------------------------------------------------------
uk_pre_customer_is.td_order_product_p5:WRITE_TRUNCATE:
select td.order_id,
          td.order_number,
          td.order_created_dt,
          cd.day_sk as order_day_sk,F
          td.order_last_updated_dt,
          td.order_created_by,
          td.order_communication_type,
          td.order_last_updated_by,
          td.contactor_role,
          cn.id as contactor_id,
          td.portfolio_id,
          td.account_number,
          td.owning_cust_account_id,
          td.order_currency,
          td.account_currency_code,
          td.account_type_code,
          td.account_sub_type_code,
          td.dialled_number,
          td.interest_source_id,
          td.referring_customer_party_id,
          td.order_urn,
          td.sale_retailer_id,
          td.bb_technology_code,
          td.lr_technology_code,
          td.st_technology_code,
          td.order_status,
          td.order_status_start_dt,
          td.order_status_reason_code,
          td.order_system_fix,
          td.order_sale_speed,
          td.order_sale_type,
          td.bundle_id,
          td.telephony_order_type,
          td.new_customer_flag,
          td.first_order_flag,
          td.type_1_saletype,
          td.type_1_adds,
          td.type_1_removes,
          td.type_1_added_sk,
          td.type_1_removed_sk,
          td.type_1_add_sub,
          td.type_2_saletype,
          td.type_2_adds,
          td.type_2_removes,
          td.type_2_added_sk,
          td.type_2_removed_sk,
          td.type_2_add_sub,
          td.type_3_saletype,
          td.type_3_adds,
          td.type_3_removes,
          td.type_3_added_sk,
          td.type_3_removed_sk,
          td.type_3_add_sub,
          td.type_4_saletype,
          td.type_4_adds,
          td.type_4_removes,
          td.type_4_added_sk,
          td.type_4_removed_sk,
          td.type_4_add_sub,
          td.type_5_saletype,
          td.type_5_adds,
          td.type_5_removes,
          td.type_5_added_sk,
          td.type_5_removed_sk,
          td.type_5_add_sub,
          td.type_6_saletype,
          td.type_6_adds,
          td.type_6_removes,
          td.type_6_added_sk,
          td.type_6_removed_sk,
          td.type_6_add_sub,
          td.type_7_saletype,
          td.type_7_adds,
          td.type_7_removes,
          td.type_7_added_sk,
          td.type_7_removed_sk,
          td.type_7_add_sub,
          td.type_8_saletype,
          td.type_8_adds,
          td.type_8_removes,
          td.type_8_added_sk,
          td.type_8_removed_sk,
          td.type_8_add_sub,
          td.type_9_saletype,
          td.type_9_adds,
          td.type_9_removes,
          td.type_9_added_sk,
          td.type_9_removed_sk,
          td.type_9_add_sub,
          td.type_10_saletype,
          td.type_10_adds,
          td.type_10_removes,
          td.type_10_added_sk,
          td.type_10_removed_sk,
          td.type_10_add_sub,
          td.type_11_saletype,
          td.type_11_adds,
          td.type_11_removes,
          td.type_11_added_sk,
          td.type_11_removed_sk,
          td.type_11_add_sub,
          td.type_12_saletype,
          td.type_12_adds,
          td.type_12_removes,
          td.type_12_added_sk,
          td.type_12_removed_sk,
          td.type_12_add_sub,
          td.type_13_saletype,
          td.type_13_adds,
          td.type_13_removes,
          td.type_13_added_sk,
          td.type_13_removed_sk,
          td.type_13_add_sub,
          td.type_14_saletype,
          td.type_14_adds,
          td.type_14_removes,
          td.type_14_added_sk,
          td.type_14_removed_sk,
          td.type_14_add_sub,
          td.type_15_saletype,
          td.type_15_adds,
          td.type_15_removes,
          td.type_15_added_sk,
          td.type_15_removed_sk,
          td.type_15_add_sub,
          td.type_16_saletype,
          td.type_16_adds,
          td.type_16_removes,
          td.type_16_added_sk,
          td.type_16_removed_sk,
          td.type_16_add_sub,
          td.type_17_saletype,
          td.type_17_adds,
          td.type_17_removes,
          td.type_17_added_sk,
          td.type_17_removed_sk,
          td.type_17_add_sub,
          td.type_18_saletype,
          td.type_18_adds,
          td.type_18_removes,
          td.type_18_added_sk,
          td.type_18_removed_sk,
          td.type_18_add_sub,
          td.type_19_saletype,
          td.type_19_adds,
          td.type_19_removes,
          td.type_19_added_sk,
          td.type_19_removed_sk,
          td.type_19_add_sub,
          td.type_20_saletype,
          td.type_20_adds,
          td.type_20_removes,
          td.type_20_added_sk,
          td.type_20_removed_sk,
          td.type_20_add_sub,
          td.type_21_saletype,
          td.type_21_adds,
          td.type_21_removes,
          td.type_21_added_sk,
          td.type_21_removed_sk,
          td.type_21_add_sub,
          td.type_22_saletype,
          td.type_22_adds,
          td.type_22_removes,
          td.type_22_added_sk,
          td.type_22_removed_sk,
          td.type_22_add_sub,
          td.type_23_saletype,
          td.type_23_adds,
          td.type_23_removes,
          td.type_23_added_sk,
          td.type_23_removed_sk,
          td.type_23_add_sub,
          td.type_24_saletype,
          td.type_24_adds,
          td.type_24_removes,
          td.type_24_added_sk,
          td.type_24_removed_sk,
          td.type_24_add_sub,
          td.type_25_saletype,
          td.type_25_adds,
          td.type_25_removes,
          td.type_25_added_sk,
          td.type_25_removed_sk,
          td.type_25_add_sub,
          td.type_26_saletype,
          td.type_26_adds,
          td.type_26_removes,
          td.type_26_added_sk,
          td.type_26_removed_sk,
          td.type_26_add_sub,
          td.type_27_saletype,
          td.type_27_adds,
          td.type_27_removes,
          td.type_27_added_sk,
          td.type_27_removed_sk,
          td.type_27_add_sub,
          td.type_28_saletype,
          td.type_28_adds,
          td.type_28_removes,
          td.type_28_added_sk,
          td.type_28_removed_sk,
          td.type_28_add_sub,
          td.type_29_saletype,
          td.type_29_adds,
          td.type_29_removes,
          td.type_29_added_sk,
          td.type_29_removed_sk,
          td.type_29_add_sub,
          td.type_30_saletype,
          td.type_30_adds,
          td.type_30_removes,
          td.type_30_added_sk,
          td.type_30_removed_sk,
          td.type_30_add_sub,
          td.type_31_saletype,
          td.type_31_adds,
          td.type_31_removes,
          td.type_31_added_sk,
          td.type_31_removed_sk,
          td.type_31_add_sub,
          td.type_32_saletype,
          td.type_32_adds,
          td.type_32_removes,
          td.type_32_added_sk,
          td.type_32_removed_sk,
          td.type_32_add_sub,
          td.type_33_saletype,
          td.type_33_adds,
          td.type_33_removes,
          td.type_33_added_sk,
          td.type_33_removed_sk,
          td.type_33_add_sub,
          td.type_34_saletype,
          td.type_34_adds,
          td.type_34_removes,
          td.type_34_added_sk,
          td.type_34_removed_sk,
          td.type_34_add_sub,
          td.type_35_saletype,
          td.type_35_adds,
          td.type_35_removes,
          td.type_35_added_sk,
          td.type_35_removed_sk,
          td.type_35_add_sub,
          td.type_36_saletype,
          td.type_36_adds,
          td.type_36_removes,
          td.type_36_added_sk,
          td.type_36_removed_sk,
          td.type_36_add_sub,
          td.type_37_saletype,
          td.type_37_adds,
          td.type_37_removes,
          td.type_37_added_sk,
          td.type_37_removed_sk,
          td.type_37_add_sub,
          td.type_38_saletype,
          td.type_38_adds,
          td.type_38_removes,
          td.type_38_added_sk,
          td.type_38_removed_sk,
          td.type_38_add_sub,
          td.type_39_saletype,
          td.type_39_adds,
          td.type_39_removes,
          td.type_39_added_sk,
          td.type_39_removed_sk,
          td.type_39_add_sub,
          td.type_40_saletype,
          td.type_40_adds,
          td.type_40_removes,
          td.type_40_added_sk,
          td.type_40_removed_sk,
          td.type_40_add_sub,
          td.type_41_saletype,
          td.type_41_adds,
          td.type_41_removes,
          td.type_41_added_sk,
          td.type_41_removed_sk,
          td.type_41_add_sub,
          td.type_42_saletype,
          td.type_42_adds,
          td.type_42_removes,
          td.type_42_added_sk,
          td.type_42_removed_sk,
          td.type_42_add_sub,
          td.type_43_saletype,
          td.type_43_adds,
          td.type_43_removes,
          td.type_43_added_sk,
          td.type_43_removed_sk,
          td.type_43_add_sub,
          td.type_44_saletype,
          td.type_44_adds,
          td.type_44_removes,
          td.type_44_added_sk,
          td.type_44_removed_sk,
          td.type_44_add_sub,
          td.type_45_saletype,
          td.type_45_adds,
          td.type_45_removes,
          td.type_45_added_sk,
          td.type_45_removed_sk,
          td.type_45_add_sub,
          td.type_46_saletype,
          td.type_46_adds,
          td.type_46_removes,
          td.type_46_added_sk,
          td.type_46_removed_sk,
          td.type_46_add_sub,
          td.type_47_saletype,
          td.type_47_adds,
          td.type_47_removes,
          td.type_47_added_sk,
          td.type_47_removed_sk,
          td.type_47_add_sub,
          td.type_48_saletype,
          td.type_48_adds,
          td.type_48_removes,
          td.type_48_added_sk,
          td.type_48_removed_sk,
          td.type_48_add_sub,
          td.type_49_saletype,
          td.type_49_adds,
          td.type_49_removes,
          td.type_49_added_sk,
          td.type_49_removed_sk,
          td.type_49_add_sub,
          td.type_50_saletype,
          td.type_50_adds,
          td.type_50_removes,
          td.type_50_added_sk,
          td.type_50_removed_sk,
          td.type_50_add_sub,
          td.type_51_saletype,
          td.type_51_adds,
          td.type_51_removes,
          td.type_51_added_sk,
          td.type_51_removed_sk,
          td.type_51_add_sub,
          td.type_52_saletype,
          td.type_52_adds,
          td.type_52_removes,
          td.type_52_added_sk,
          td.type_52_removed_sk,
          td.type_52_add_sub,
          td.type_53_saletype,
          td.type_53_adds,
          td.type_53_removes,
          td.type_53_added_sk,
          td.type_53_removed_sk,
          td.type_53_add_sub,
          td.type_54_saletype,
          td.type_54_adds,
          td.type_54_removes,
          td.type_54_added_sk,
          td.type_54_removed_sk,
          td.type_54_add_sub,
          td.type_55_saletype,
          td.type_55_adds,
          td.type_55_removes,
          td.type_55_added_sk,
          td.type_55_removed_sk,
          td.type_55_add_sub,
          td.type_56_saletype,
          td.type_56_adds,
          td.type_56_removes,
          td.type_56_added_sk,
          td.type_56_removed_sk,
          td.type_56_add_sub,
          td.type_57_saletype,
          td.type_57_adds,
          td.type_57_removes,
          td.type_57_added_sk,
          td.type_57_removed_sk,
          td.type_57_add_sub,
          td.type_58_saletype,
          td.type_58_adds,
          td.type_58_removes,
          td.type_58_added_sk,
          td.type_58_removed_sk,
          td.type_58_add_sub,
          td.type_59_saletype,
          td.type_59_adds,
          td.type_59_removes,
          td.type_59_added_sk,
          td.type_59_removed_sk,
          td.type_59_add_sub,
          td.type_60_saletype,
          td.type_60_adds,
          td.type_60_removes,
          td.type_60_added_sk,
          td.type_60_removed_sk,
          td.type_60_add_sub,
          td.type_61_saletype,
          td.type_61_adds,
          td.type_61_removes,
          td.type_61_added_sk,
          td.type_61_removed_sk,
          td.type_61_add_sub,
          td.type_62_saletype,
          td.type_62_adds,
          td.type_62_removes,
          td.type_62_added_sk,
          td.type_62_removed_sk,
          td.type_62_add_sub,
          td.type_63_saletype,
          td.type_63_adds,
          td.type_63_removes,
          td.type_63_added_sk,
          td.type_63_removed_sk,
          td.type_63_add_sub,
          td.type_64_saletype,
          td.type_64_adds,
          td.type_64_removes,
          td.type_64_added_sk,
          td.type_64_removed_sk,
          td.type_64_add_sub,
          td.type_65_saletype,
          td.type_65_adds,
          td.type_65_removes,
          td.type_65_added_sk,
          td.type_65_removed_sk,
          td.type_65_add_sub,
          td.type_66_saletype,
          td.type_66_adds,
          td.type_66_removes,
          td.type_66_added_sk,
          td.type_66_removed_sk,
          td.type_66_add_sub,
          td.type_67_saletype,
          td.type_67_adds,
          td.type_67_removes,
          td.type_67_added_sk,
          td.type_67_removed_sk,
          td.type_67_add_sub,
          td.type_68_saletype,
          td.type_68_adds,
          td.type_68_removes,
          td.type_68_added_sk,
          td.type_68_removed_sk,
          td.type_68_add_sub,
          td.type_69_saletype,
          td.type_69_adds,
          td.type_69_removes,
          td.type_69_added_sk,
          td.type_69_removed_sk,
          td.type_69_add_sub,
          td.type_70_saletype,
          td.type_70_adds,
          td.type_70_removes,
          td.type_70_added_sk,
          td.type_70_removed_sk,
          td.type_70_add_sub,
          td.type_71_saletype,
          td.type_71_adds,
          td.type_71_removes,
          td.type_71_added_sk,
          td.type_71_removed_sk,
          td.type_71_add_sub,
          td.type_72_saletype,
          td.type_72_adds,
          td.type_72_removes,
          td.type_72_added_sk,
          td.type_72_removed_sk,
          td.type_72_add_sub,
          td.type_73_saletype,
          td.type_73_adds,
          td.type_73_removes,
          td.type_73_added_sk,
          td.type_73_removed_sk,
          td.type_73_add_sub,
          td.type_74_saletype ,
          td.type_74_adds,
          td.type_74_removes,
          td.type_74_added_sk,
          td.type_74_removed_sk,
          td.type_74_add_sub,
          td.type_75_saletype,
          td.type_75_adds,
          td.type_75_removes,
          td.type_75_added_sk,
          td.type_75_removed_sk,
          td.type_75_add_sub,
          td.type_76_saletype,
          td.type_76_adds,
          td.type_76_removes,
          td.type_76_added_sk,
          td.type_76_removed_sk,
          td.type_76_add_sub,
          td.type_77_saletype,
          td.type_77_adds,
          td.type_77_removes,
          td.type_77_added_sk,
          td.type_77_removed_sk,
          td.type_77_add_sub,
          td.type_78_saletype ,
          td.type_78_adds,
          td.type_78_removes,
          td.type_78_added_sk,
          td.type_78_removed_sk,
          td.type_78_add_sub,
          td.type_79_saletype ,
          td.type_79_adds,
          td.type_79_removes,
          td.type_79_added_sk,
          td.type_79_removed_sk,
          td.type_79_add_sub,
          td.type_80_saletype,
          td.type_80_adds,
          td.type_80_removes,
          td.type_80_added_sk,
          td.type_80_removed_sk,
          td.type_80_add_sub,
          td.type_81_saletype,
          td.type_81_adds,
          td.type_81_removes,
          td.type_81_added_sk,
          td.type_81_removed_sk,
          td.type_81_add_sub,
          td.type_82_saletype,
          td.type_82_adds,
          td.type_82_removes,
          td.type_82_added_sk,
          td.type_82_removed_sk,
          td.type_82_add_sub,
          td.type_83_saletype,
          td.type_83_adds,
          td.type_83_removes,
          td.type_83_added_sk,
          td.type_83_removed_sk,
          td.type_83_add_sub,
          td.type_84_saletype,
          td.type_84_adds,
          td.type_84_removes,
          td.type_84_added_sk,
          td.type_84_removed_sk,
          td.type_84_add_sub,
          td.type_85_saletype,
          td.type_85_adds,
          td.type_85_removes,
          td.type_85_added_sk,
          td.type_85_removed_sk,
          td.type_85_add_sub,
          td.type_86_saletype,
          td.type_86_adds,
          td.type_86_removes,
          td.type_86_added_sk,
          td.type_86_removed_sk,
          td.type_86_add_sub,
          td.type_87_saletype,
          td.type_87_adds,
          td.type_87_removes,
          td.type_87_added_sk,
          td.type_87_removed_sk,
          td.type_87_add_sub,
          td.type_88_saletype, 
          td.type_88_adds,
          td.type_88_removes,
          td.type_88_added_sk,
          td.type_88_removed_sk,
          td.type_88_add_sub,
          td.type_89_saletype,
          td.type_89_adds,
          td.type_89_removes,
          td.type_89_added_sk,
          td.type_89_removed_sk,
          td.type_89_add_sub,
          td.type_90_saletype,
          td.type_90_adds,
          td.type_90_removes,
          td.type_90_added_sk,
          td.type_90_removed_sk,
          td.type_90_add_sub,      
          td.prem_sale_type,
          td.prem_adds,
          td.prem_removes,
          td.prem_sports_added,
          td.prem_movies_added,
          td.prem_sports_removed,
          td.prem_movies_removed
     from uk_pre_customer_is.td_order_product_p4 td
     left outer join uk_pub_customer_is.cal_day_dim cd
      on (date(td.order_created_dt) = cd.day_id)
     left outer join uk_inp_tds_chordiant_eod_is.cc_bsbcustomerrole cr
      on (    td.contactor_role = cr.partyroleid
          and cr.logically_deleted = 0)
     left outer join uk_inp_tds_chordiant_eod_is.cc_bsbpartyrole pr
      on (    cr.partyroleid = pr.id
          and pr.logically_deleted = 0)
     left outer join uk_inp_tds_chordiant_eod_is.cc_bsbcontactor cn
      on (    cn.partyid = pr.partyid
          and cn.logically_deleted = 0 );


--------------------------------------------------------------------------------
--Populate td_order_product_p6 - Join to get newly defined RTM values based on 
--INFOMART data as well as information from chordiant retailers.
-------------------------------------------------------------------------------- 
uk_pre_customer_is.td_order_product_p6:WRITE_TRUNCATE:
select td.order_id,
          td.order_number,
          td.order_created_dt,
          td.order_day_sk,
          td.order_last_updated_dt,
          td.order_created_by,
          td.order_communication_type,
          td.order_last_updated_by,
          td.contactor_role,
          td.contactor_id,
          td.portfolio_id,
          td.account_number,
          td.owning_cust_account_id,
          td.order_currency,
          td.account_currency_code,
          td.account_type_code,
          td.account_sub_type_code,
          td.dialled_number,
          td.interest_source_id,
          td.referring_customer_party_id,
          td.order_urn,
          td.sale_retailer_id,
          skg.skillgroup as skill_group,
          case
            when ret.asagroupnumber in ('11164') and cast(ret.asabranchnumber as int) >= 4000 and cast(ret.asabranchnumber as int) <= 4999 then
            'Sky Shops'          
            when ret.asagroupnumber in ('11112','22086','22220','22241','22242','22253','22254','81029','81035','81036') then 
            'Homes & Indies'
            when ret.asagroupnumber in ('43000') and substr(ret.asabranchnumber,1,1) in ('0','1','2','3','4') then
            'Retail'
            when ret.asagroupnumber in ('43000') and substr(ret.asabranchnumber,1,1) in ('5','6','7','8','9') then
            'Retail'
            when ret.asagroupnumber in ('11164','81169')  then 
            'Retail'
            when ret.asagroupnumber in ('48000') then 
            'Retail'
            when ret.asagroupnumber in ('01385','01726','03138','06521','09892','10089','10638','20354','21912','21956','22052','81028') then 
            'Homes & Indies'
            when ret.asagroupnumber = '22252' then 
            'Direct'            
            when ret.asagroupnumber = '22285' then
            'Retail'            
            when ret.asabranchnumber in ('7777','8888') then 
            'Retail'
            when ret.asagroupnumber = '22394' then
            'Homes & Indies'
            when ret.asabranchnumber in ('1111') then 
            'Homes & Indies'
            when td.sale_retailer_id is not null then 
            'Homes & Indies'
            when td.order_communication_type = 'MESSAGING' then
            'Direct'
            when upper(skg.skillgroup) like '%SAVE%'  and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%SAVE%' and td.dialled_number = '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%SAVE%' then
            'Direct'
            when upper(skg.skillgroup) like '%RETENTION%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%RETENTION%' and td.dialled_number = '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%RETENTION%' then
            'Direct'
            when upper(skg.skillgroup) like '%WINBACK%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%WINBACK%' and td.dialled_number = '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%WINBACK%' then
            'Direct'
            when upper(skg.skillgroup) like '%CHURN%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%CHURN%' and td.dialled_number = '-99999' then
            'Direct'  
            when upper(skg.skillgroup) like '%CHURN%' then
            'Direct'
            when upper(skg.skillgroup) like '%SELL%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%SELL%' and td.dialled_number = '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%SELL%' then
            'Direct'
            when upper(skg.skillgroup) like '%SALE%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%SALE%' and td.dialled_number = '-99999' then 
            'Direct'
            when upper(skg.skillgroup) like '%SALE%' then 
            'Direct'
            when skg.skillgroup is not null and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct'
            when skg.skillgroup is not null and td.dialled_number = '-99999' then 
            'Direct'
            when skg.skillgroup is not null then
            'Direct'
            when substr(td.order_created_by,1,2) = 'd1' then 
            'Direct'
            when substr(td.order_created_by,1,2) = 'a1' then 
            'Direct'
            when substr(td.order_created_by,1,1) = '5' then 
            'Direct'
            when substr(td.order_created_by,1,2) = 'c5' then 
            'Direct'
            when substr(td.order_created_by,1,2) = 's5' then 
            'Direct'
            when substr(td.order_created_by,1,2) = 'c4' then 
            'Direct'
            when substr(td.order_created_by,1,2) = 'c2' then 
            'Direct'
            when td.order_created_by in ('dpsbtprd','middleware','eservice','orderhandling','WPS','batchuser','wpsadmin','OH','BATCHPROCESS','ProcessServer','MHR', 'myskyappuser') then 
            'Digital'
            when td.order_created_by in ('GVP','IVR') then 
            'Digital'
            when td.order_created_by in ('webuser','nowtv-payments') and td.order_communication_type = 'IVR' then 
            'Digital'
            when td.order_created_by in ('isales','iservice','interactive','interactive-gateway') then 
            'Digital'
            when td.order_created_by in ('psponlineuser','webuser','PSP-ONLINE','oam','sky-mobile-sales','sky-services','nowtv-payments','ordermanagement','digitaltrading_shop') then
            'Digital'  
          else 
            'Direct' 
          end             as rtm_level_1,
         case             
            when ret.asagroupnumber in ('11164') and cast(ret.asabranchnumber as int) >= 4000 and cast(ret.asabranchnumber as int) <= 4999 then
            'Retail'
            when ret.asagroupnumber in ('11112','22086','22220','22241','22242','22253','22254','81029','81035','81036') then 
            'Multiples'
            when ret.asagroupnumber in ('43000') and substr(ret.asabranchnumber,1,1) in ('0','1','2','3','4') then
            'Events & Partnerships'
            when ret.asagroupnumber in ('43000') and substr(ret.asabranchnumber,1,1) in ('5','6','7','8','9') then
            'Events & Partnerships'
            when ret.asagroupnumber in ('11164','81169')  then 
            'SRS'
            when ret.asagroupnumber in ('48000')  then 
            'Walkers'
            when ret.asagroupnumber in ('01385','01726','03138','06521','09892','10089','10638','20354','21912','21956','22052','81028') then 
            'Homes'
            when ret.asagroupnumber = '22252' then 
            'Direct 3rd Party'            
            when ret.asagroupnumber = '22285' then
            'STS Engineers'
            when ret.asagroupnumber = '22394' then
            'Inbound'
            when ret.asabranchnumber in ('7777','8888') then 
            'Events & Partnerships'
            when ret.asabranchnumber in ('1111') then 
            'Homes'
            when td.sale_retailer_id is not null then 
            'Independents'
            when td.order_communication_type = 'MESSAGING' then
            'Direct ASM'
            when upper(skg.skillgroup) like '%SAVE%'  and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%SAVE%' and td.dialled_number = '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%SAVE%' then
            'Direct Save'
            when upper(skg.skillgroup) like '%RETENTION%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%RETENTION%' and td.dialled_number = '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%RETENTION%' then
            'Direct Save'
            when upper(skg.skillgroup) like '%WINBACK%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%WINBACK%' and td.dialled_number = '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%WINBACK%' then
            'Direct Save'
            when upper(skg.skillgroup) like '%CHURN%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save'
            when upper(skg.skillgroup) like '%CHURN%' and td.dialled_number = '-99999' then
            'Direct Save'  
            when upper(skg.skillgroup) like '%CHURN%' then
            'Direct Save'
            when upper(skg.skillgroup) like '%SELL%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Sell'
            when upper(skg.skillgroup) like '%SELL%' and td.dialled_number = '-99999' then 
            'Direct Sell'
            when upper(skg.skillgroup) like '%SELL%' then
            'Direct Sell'
            when upper(skg.skillgroup) like '%SALE%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Sell'
            when upper(skg.skillgroup) like '%SALE%' and td.dialled_number = '-99999' then 
            'Direct Sell'
            when upper(skg.skillgroup) like '%SALE%' then 
            'Direct Sell'
            when skg.skillgroup is not null and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Serve'
            when skg.skillgroup is not null and td.dialled_number = '-99999' then 
            'Direct Serve'
            when skg.skillgroup is not null then
            'Direct Serve'
            when substr(td.order_created_by,1,2) = 'd1' then 
            'Direct Serve'
            when substr(td.order_created_by,1,2) = 'a1' then 
            'Direct Sell'
            when substr(td.order_created_by,1,1) = '5' then 
            'Direct Serve'
            when substr(td.order_created_by,1,2) = 'c5' then 
            'Direct Save'
            when substr(td.order_created_by,1,2) = 's5' then 
            'Direct Serve'
            when substr(td.order_created_by,1,2) = 'c4' then 
            'Direct Serve'
            when substr(td.order_created_by,1,2) = 'c2' then 
            'Direct Serve'
            when td.order_created_by in ('dpsbtprd','middleware','eservice','orderhandling','WPS','batchuser','wpsadmin','OH','BATCHPROCESS','ProcessServer','MHR') then 
            'Known Digital Other'
            when td.order_created_by in ('GVP','IVR') then 
            'IVR'
            when td.order_created_by in ('webuser','nowtv-payments') and td.order_communication_type = 'IVR' then 
            'IVR'
            when td.order_created_by in ('isales','iservice','interactive','interactive-gateway') then 
            'Red Button'
            when td.order_created_by in ('psponlineuser','webuser','PSP-ONLINE','oam','sky-mobile-sales', 'sky-services' ,'nowtv-payments','ordermanagement','digitaltrading_shop') then
            'Online'  
            when td.order_created_by in ( 'myskyappuser') then
            'MySky App'
          else 
            'Direct Other' 
          end             as rtm_level_2,
          case
            when ret.asagroupnumber in ('11164') and cast(ret.asabranchnumber as int) >= 4000 and cast(ret.asabranchnumber as int) <= 4999 then
            'Retail'          
            when ret.asagroupnumber in ('11112','22086','22220','22241','22242','22253','22254','81029','81035','81036') then 
            'Multiples'
            when ret.asagroupnumber in ('43000') and substr(ret.asabranchnumber,1,1) in ('0','1','2','3','4') then
            'Events'
            when ret.asagroupnumber in ('43000') and substr(ret.asabranchnumber,1,1) in('5','6','7','8','9') then
            'Partnerships'
            when ret.asagroupnumber in ('11164','81169')  then 
            'SRS'
            when ret.asagroupnumber in ('48000')  then 
            'Walkers'
            when ret.asagroupnumber in ('01385','01726','03138','06521','09892','10089','10638','20354','21912','21956','22052','81028') then 
            'Homes'
            when ret.asagroupnumber = '22252' then 
            'ResQ'        
            when ret.asagroupnumber = '22285' then
            'STS Engineers'
            when ret.asagroupnumber = '22394' then
            'UKWEBMEDIA'
            when ret.asabranchnumber in ('7777','8888') then 
            'Events'
            when ret.asabranchnumber in ('1111') then 
            'Homes'
            when td.sale_retailer_id is not null then 
            'Independents'
            when td.order_communication_type = 'MESSAGING' then
            'Direct ASM'
            when upper(skg.skillgroup) like '%SAVE%'  and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save Inbound'
            when upper(skg.skillgroup) like '%SAVE%' and td.dialled_number = '-99999' then 
            'Direct Save Outbound'
            when upper(skg.skillgroup) like '%SAVE%' then
            'Direct Save Other'
            when upper(skg.skillgroup) like '%RETENTION%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save Inbound'
            when upper(skg.skillgroup) like '%RETENTION%' and td.dialled_number = '-99999' then 
            'Direct Save Outbound'
            when upper(skg.skillgroup) like '%RETENTION%' then
            'Direct Save Other'
            when upper(skg.skillgroup) like '%WINBACK%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save Inbound'
            when upper(skg.skillgroup) like '%WINBACK%' and td.dialled_number = '-99999' then 
            'Direct Save Outbound'
            when upper(skg.skillgroup) like '%WINBACK%' then
            'Direct Save Other'
            when upper(skg.skillgroup) like '%CHURN%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Save Inbound'
            when upper(skg.skillgroup) like '%CHURN%' and td.dialled_number = '-99999' then
            'Direct Save Outbound'  
            when upper(skg.skillgroup) like '%CHURN%' then
            'Direct Save Other'
            when upper(skg.skillgroup) like '%SELL%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Sell Inbound'
            when upper(skg.skillgroup) like '%SELL%' and td.dialled_number = '-99999' then 
            'Direct Sell Outbound'
            when upper(skg.skillgroup) like '%SELL%' then
            'Direct Sell Other'
            when upper(skg.skillgroup) like '%SALE%' and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Sell Inbound'
            when upper(skg.skillgroup) like '%SALE%' and td.dialled_number = '-99999' then 
            'Direct Sell Outbound'
            when upper(skg.skillgroup) like '%SALE%' then 
            'Direct Sell Other'
            when skg.skillgroup is not null and td.order_communication_type = 'PHONE' and td.dialled_number <> '-99999' then 
            'Direct Serve Inbound'
            when skg.skillgroup is not null and td.dialled_number = '-99999' then 
            'Direct Serve Outbound'
            when skg.skillgroup is not null then
            'Direct Serve Other'
            when substr(td.order_created_by,1,2) = 'd1' then 
            'Direct Serve Other'
            when substr(td.order_created_by,1,2) = 'a1' then 
            'Direct Sell Other'
            when substr(td.order_created_by,1,1) = '5' then 
            'Direct Serve Other'
            when substr(td.order_created_by,1,2) = 'c5' then 
            'Direct Save Other'
            when substr(td.order_created_by,1,2) = 's5' then 
            'Direct Serve Other'
            when substr(td.order_created_by,1,2) = 'c4' then 
            'Direct Serve Other'
            when substr(td.order_created_by,1,2) = 'c2' then 
            'Direct Serve Other'
            when td.order_created_by in ('dpsbtprd','middleware','eservice','orderhandling','WPS','batchuser','wpsadmin','OH','BATCHPROCESS','ProcessServer','MHR') then 
            'Known Digital Other'
            when td.order_created_by in ('GVP','IVR') then 
            'IVR'
            when td.order_created_by in ('webuser','nowtv-payments') and td.order_communication_type = 'IVR' then 
            'IVR'
            when td.order_created_by in ('isales','iservice','interactive','interactive-gateway') then 
            'Red Button'
            when td.order_created_by in ('psponlineuser','webuser','PSP-ONLINE','oam','sky-mobile-sales', 'sky-services', 'nowtv-payments','ordermanagement','digitaltrading_shop') then
            'Online'  
            when td.order_created_by in ( 'myskyappuser') then
            'MySky App'
          else 
            'Direct Other' 
          end             as rtm_level_3,
          td.bb_technology_code,
          td.lr_technology_code,
          td.st_technology_code,
          td.order_status,
          td.order_status_start_dt,
          td.order_status_reason_code,
          td.order_system_fix,
          td.order_sale_speed,
          td.order_sale_type,
          td.bundle_id,
          td.telephony_order_type,
          td.new_customer_flag,
          td.first_order_flag,
          td.type_1_saletype,
          td.type_1_adds,
          td.type_1_removes,
          td.type_1_added_sk,
          td.type_1_removed_sk,
          td.type_1_add_sub,
          td.type_2_saletype,
          td.type_2_adds,
          td.type_2_removes,
          td.type_2_added_sk,
          td.type_2_removed_sk,
          td.type_2_add_sub,
          td.type_3_saletype,
          td.type_3_adds,
          td.type_3_removes,
          td.type_3_added_sk,
          td.type_3_removed_sk,
          td.type_3_add_sub,
          td.type_4_saletype,
          td.type_4_adds,
          td.type_4_removes,
          td.type_4_added_sk,
          td.type_4_removed_sk,
          td.type_4_add_sub,
          td.type_5_saletype,
          td.type_5_adds,
          td.type_5_removes,
          td.type_5_added_sk,
          td.type_5_removed_sk,
          td.type_5_add_sub,
          td.type_6_saletype,
          td.type_6_adds,
          td.type_6_removes,
          td.type_6_added_sk,
          td.type_6_removed_sk,
          td.type_6_add_sub,
          td.type_7_saletype,
          td.type_7_adds,
          td.type_7_removes,
          td.type_7_added_sk,
          td.type_7_removed_sk,
          td.type_7_add_sub,
          td.type_8_saletype,
          td.type_8_adds,
          td.type_8_removes,
          td.type_8_added_sk,
          td.type_8_removed_sk,
          td.type_8_add_sub,
          td.type_9_saletype,
          td.type_9_adds,
          td.type_9_removes,
          td.type_9_added_sk,
          td.type_9_removed_sk,
          td.type_9_add_sub,
          td.type_10_saletype,
          td.type_10_adds,
          td.type_10_removes,
          td.type_10_added_sk,
          td.type_10_removed_sk,
          td.type_10_add_sub,
          td.type_11_saletype,
          td.type_11_adds,
          td.type_11_removes,
          td.type_11_added_sk,
          td.type_11_removed_sk,
          td.type_11_add_sub,
          td.type_12_saletype,
          td.type_12_adds,
          td.type_12_removes,
          td.type_12_added_sk,
          td.type_12_removed_sk,
          td.type_12_add_sub,
          td.type_13_saletype,
          td.type_13_adds,
          td.type_13_removes,
          td.type_13_added_sk,
          td.type_13_removed_sk,
          td.type_13_add_sub,
          td.type_14_saletype,
          td.type_14_adds,
          td.type_14_removes,
          td.type_14_added_sk,
          td.type_14_removed_sk,
          td.type_14_add_sub,
          td.type_15_saletype,
          td.type_15_adds,
          td.type_15_removes,
          td.type_15_added_sk,
          td.type_15_removed_sk,
          td.type_15_add_sub,
          td.type_16_saletype,
          td.type_16_adds,
          td.type_16_removes,
          td.type_16_added_sk,
          td.type_16_removed_sk,
          td.type_16_add_sub,
          td.type_17_saletype,
          td.type_17_adds,
          td.type_17_removes,
          td.type_17_added_sk,
          td.type_17_removed_sk,
          td.type_17_add_sub,
          td.type_18_saletype,
          td.type_18_adds,
          td.type_18_removes,
          td.type_18_added_sk,
          td.type_18_removed_sk,
          td.type_18_add_sub,
          td.type_19_saletype,
          td.type_19_adds,
          td.type_19_removes,
          td.type_19_added_sk,
          td.type_19_removed_sk,
          td.type_19_add_sub,
          td.type_20_saletype,
          td.type_20_adds,
          td.type_20_removes,
          td.type_20_added_sk,
          td.type_20_removed_sk,
          td.type_20_add_sub,
          td.type_21_saletype,
          td.type_21_adds,
          td.type_21_removes,
          td.type_21_added_sk,
          td.type_21_removed_sk,
          td.type_21_add_sub,
          td.type_22_saletype,
          td.type_22_adds,
          td.type_22_removes,
          td.type_22_added_sk,
          td.type_22_removed_sk,
          td.type_22_add_sub,
          td.type_23_saletype,
          td.type_23_adds,
          td.type_23_removes,
          td.type_23_added_sk,
          td.type_23_removed_sk,
          td.type_23_add_sub,
          td.type_24_saletype,
          td.type_24_adds,
          td.type_24_removes,
          td.type_24_added_sk,
          td.type_24_removed_sk,
          td.type_24_add_sub,
          td.type_25_saletype,
          td.type_25_adds,
          td.type_25_removes,
          td.type_25_added_sk,
          td.type_25_removed_sk,
          td.type_25_add_sub,
          td.type_26_saletype,
          td.type_26_adds,
          td.type_26_removes,
          td.type_26_added_sk,
          td.type_26_removed_sk,
          td.type_26_add_sub,
          td.type_27_saletype,
          td.type_27_adds,
          td.type_27_removes,
          td.type_27_added_sk,
          td.type_27_removed_sk,
          td.type_27_add_sub,
          td.type_28_saletype,
          td.type_28_adds,
          td.type_28_removes,
          td.type_28_added_sk,
          td.type_28_removed_sk,
          td.type_28_add_sub,
          td.type_29_saletype,
          td.type_29_adds,
          td.type_29_removes,
          td.type_29_added_sk,
          td.type_29_removed_sk,
          td.type_29_add_sub,
          td.type_30_saletype,
          td.type_30_adds,
          td.type_30_removes,
          td.type_30_added_sk,
          td.type_30_removed_sk,
          td.type_30_add_sub,
          td.type_31_saletype,
          td.type_31_adds,
          td.type_31_removes,
          td.type_31_added_sk,
          td.type_31_removed_sk,
          td.type_31_add_sub,
          td.type_32_saletype,
          td.type_32_adds,
          td.type_32_removes,
          td.type_32_added_sk,
          td.type_32_removed_sk,
          td.type_32_add_sub,
          td.type_33_saletype,
          td.type_33_adds,
          td.type_33_removes,
          td.type_33_added_sk,
          td.type_33_removed_sk,
          td.type_33_add_sub,
          td.type_34_saletype,
          td.type_34_adds,
          td.type_34_removes,
          td.type_34_added_sk,
          td.type_34_removed_sk,
          td.type_34_add_sub,
          td.type_35_saletype,
          td.type_35_adds,
          td.type_35_removes,
          td.type_35_added_sk,
          td.type_35_removed_sk,
          td.type_35_add_sub,
          td.type_36_saletype,
          td.type_36_adds,
          td.type_36_removes,
          td.type_36_added_sk,
          td.type_36_removed_sk,
          td.type_36_add_sub,
          td.type_37_saletype,
          td.type_37_adds,
          td.type_37_removes,
          td.type_37_added_sk,
          td.type_37_removed_sk,
          td.type_37_add_sub,
          td.type_38_saletype,
          td.type_38_adds,
          td.type_38_removes,
          td.type_38_added_sk,
          td.type_38_removed_sk,
          td.type_38_add_sub,
          td.type_39_saletype,
          td.type_39_adds,
          td.type_39_removes,
          td.type_39_added_sk,
          td.type_39_removed_sk,
          td.type_39_add_sub,
          td.type_40_saletype,
          td.type_40_adds,
          td.type_40_removes,
          td.type_40_added_sk,
          td.type_40_removed_sk,
          td.type_40_add_sub,
          td.type_41_saletype,
          td.type_41_adds,
          td.type_41_removes,
          td.type_41_added_sk,
          td.type_41_removed_sk,
          td.type_41_add_sub,
          td.type_42_saletype,
          td.type_42_adds,
          td.type_42_removes,
          td.type_42_added_sk,
          td.type_42_removed_sk,
          td.type_42_add_sub,
          td.type_43_saletype,
          td.type_43_adds,
          td.type_43_removes,
          td.type_43_added_sk,
          td.type_43_removed_sk,
          td.type_43_add_sub,
          td.type_44_saletype,
          td.type_44_adds,
          td.type_44_removes,
          td.type_44_added_sk,
          td.type_44_removed_sk,
          td.type_44_add_sub,
          td.type_45_saletype,
          td.type_45_adds,
          td.type_45_removes,
          td.type_45_added_sk,
          td.type_45_removed_sk,
          td.type_45_add_sub,
          td.type_46_saletype,
          td.type_46_adds,
          td.type_46_removes,
          td.type_46_added_sk,
          td.type_46_removed_sk,
          td.type_46_add_sub,
          td.type_47_saletype,
          td.type_47_adds,
          td.type_47_removes,
          td.type_47_added_sk,
          td.type_47_removed_sk,
          td.type_47_add_sub,
          td.type_48_saletype,
          td.type_48_adds,
          td.type_48_removes,
          td.type_48_added_sk,
          td.type_48_removed_sk,
          td.type_48_add_sub,
          td.type_49_saletype,
          td.type_49_adds,
          td.type_49_removes,
          td.type_49_added_sk,
          td.type_49_removed_sk,
          td.type_49_add_sub,
          td.type_50_saletype,
          td.type_50_adds,
          td.type_50_removes,
          td.type_50_added_sk,
          td.type_50_removed_sk,
          td.type_50_add_sub,
          td.type_51_saletype,
          td.type_51_adds,
          td.type_51_removes,
          td.type_51_added_sk,
          td.type_51_removed_sk,
          td.type_51_add_sub,
          td.type_52_saletype,
          td.type_52_adds,
          td.type_52_removes,
          td.type_52_added_sk,
          td.type_52_removed_sk,
          td.type_52_add_sub,
          td.type_53_saletype,
          td.type_53_adds,
          td.type_53_removes,
          td.type_53_added_sk,
          td.type_53_removed_sk,
          td.type_53_add_sub,
          td.type_54_saletype,
          td.type_54_adds,
          td.type_54_removes,
          td.type_54_added_sk,
          td.type_54_removed_sk,
          td.type_54_add_sub,
          td.type_55_saletype,
          td.type_55_adds,
          td.type_55_removes,
          td.type_55_added_sk,
          td.type_55_removed_sk,
          td.type_55_add_sub,
          td.type_56_saletype,
          td.type_56_adds,
          td.type_56_removes,
          td.type_56_added_sk,
          td.type_56_removed_sk,
          td.type_56_add_sub,
          td.type_57_saletype,
          td.type_57_adds,
          td.type_57_removes,
          td.type_57_added_sk,
          td.type_57_removed_sk,
          td.type_57_add_sub,
          td.type_58_saletype,
          td.type_58_adds,
          td.type_58_removes,
          td.type_58_added_sk,
          td.type_58_removed_sk,
          td.type_58_add_sub,
          td.type_59_saletype,
          td.type_59_adds,
          td.type_59_removes,
          td.type_59_added_sk,
          td.type_59_removed_sk,
          td.type_59_add_sub,
          td.type_60_saletype,
          td.type_60_adds,
          td.type_60_removes,
          td.type_60_added_sk,
          td.type_60_removed_sk,
          td.type_60_add_sub,
          td.type_61_saletype,
          td.type_61_adds,
          td.type_61_removes,
          td.type_61_added_sk,
          td.type_61_removed_sk,
          td.type_61_add_sub,
          td.type_62_saletype,
          td.type_62_adds,
          td.type_62_removes,
          td.type_62_added_sk,
          td.type_62_removed_sk,
          td.type_62_add_sub,
          td.type_63_saletype,
          td.type_63_adds,
          td.type_63_removes,
          td.type_63_added_sk,
          td.type_63_removed_sk,
          td.type_63_add_sub,
          td.type_64_saletype,
          td.type_64_adds,
          td.type_64_removes,
          td.type_64_added_sk,
          td.type_64_removed_sk,
          td.type_64_add_sub,
          td.type_65_saletype,
          td.type_65_adds,
          td.type_65_removes,
          td.type_65_added_sk,
          td.type_65_removed_sk,
          td.type_65_add_sub,
          td.type_66_saletype,
          td.type_66_adds,
          td.type_66_removes,
          td.type_66_added_sk,
          td.type_66_removed_sk,
          td.type_66_add_sub,
          td.type_67_saletype,
          td.type_67_adds,
          td.type_67_removes,
          td.type_67_added_sk,
          td.type_67_removed_sk,
          td.type_67_add_sub,
          td.type_68_saletype,
          td.type_68_adds,
          td.type_68_removes,
          td.type_68_added_sk,
          td.type_68_removed_sk,
          td.type_68_add_sub,
          td.type_69_saletype,
          td.type_69_adds,
          td.type_69_removes,
          td.type_69_added_sk,
          td.type_69_removed_sk,
          td.type_69_add_sub,
          td.type_70_saletype,
          td.type_70_adds,
          td.type_70_removes,
          td.type_70_added_sk,
          td.type_70_removed_sk,
          td.type_70_add_sub,
          td.type_71_saletype,
          td.type_71_adds,
          td.type_71_removes,
          td.type_71_added_sk,
          td.type_71_removed_sk,
          td.type_71_add_sub,
          td.type_72_saletype,
          td.type_72_adds,
          td.type_72_removes,
          td.type_72_added_sk,
          td.type_72_removed_sk,
          td.type_72_add_sub,
          td.type_73_saletype,
          td.type_73_adds,
          td.type_73_removes,
          td.type_73_added_sk,
          td.type_73_removed_sk,
          td.type_73_add_sub,
          td.type_74_saletype ,
          td.type_74_adds,
          td.type_74_removes,
          td.type_74_added_sk,
          td.type_74_removed_sk,
          td.type_74_add_sub,
          td.type_75_saletype,
          td.type_75_adds,
          td.type_75_removes,
          td.type_75_added_sk,
          td.type_75_removed_sk,
          td.type_75_add_sub,
          td.type_76_saletype,
          td.type_76_adds,
          td.type_76_removes,
          td.type_76_added_sk,
          td.type_76_removed_sk,
          td.type_76_add_sub,
          td.type_77_saletype,
          td.type_77_adds,
          td.type_77_removes,
          td.type_77_added_sk,
          td.type_77_removed_sk,
          td.type_77_add_sub,
          td.type_78_saletype ,
          td.type_78_adds,
          td.type_78_removes,
          td.type_78_added_sk,
          td.type_78_removed_sk,
          td.type_78_add_sub,
          td.type_79_saletype ,
          td.type_79_adds,
          td.type_79_removes,
          td.type_79_added_sk,
          td.type_79_removed_sk,
          td.type_79_add_sub,
          td.type_80_saletype,
          td.type_80_adds,
          td.type_80_removes,
          td.type_80_added_sk,
          td.type_80_removed_sk,
          td.type_80_add_sub,
          td.type_81_saletype,
          td.type_81_adds,
          td.type_81_removes,
          td.type_81_added_sk,
          td.type_81_removed_sk,
          td.type_81_add_sub,
          td.type_82_saletype,
          td.type_82_adds,
          td.type_82_removes,
          td.type_82_added_sk,
          td.type_82_removed_sk,
          td.type_82_add_sub,
          td.type_83_saletype,
          td.type_83_adds,
          td.type_83_removes,
          td.type_83_added_sk,
          td.type_83_removed_sk,
          td.type_83_add_sub,
          td.type_84_saletype,
          td.type_84_adds,
          td.type_84_removes,
          td.type_84_added_sk,
          td.type_84_removed_sk,
          td.type_84_add_sub,
          td.type_85_saletype,
          td.type_85_adds,
          td.type_85_removes,
          td.type_85_added_sk,
          td.type_85_removed_sk,
          td.type_85_add_sub,
          td.type_86_saletype,
          td.type_86_adds,
          td.type_86_removes,
          td.type_86_added_sk,
          td.type_86_removed_sk,
          td.type_86_add_sub,
          td.type_87_saletype,
          td.type_87_adds,
          td.type_87_removes,
          td.type_87_added_sk,
          td.type_87_removed_sk,
          td.type_87_add_sub,
          td.type_88_saletype, 
          td.type_88_adds,
          td.type_88_removes,
          td.type_88_added_sk,
          td.type_88_removed_sk,
          td.type_88_add_sub,
          td.type_89_saletype,
          td.type_89_adds,
          td.type_89_removes,
          td.type_89_added_sk,
          td.type_89_removed_sk,
          td.type_89_add_sub,
          td.type_90_saletype,
          td.type_90_adds,
          td.type_90_removes,
          td.type_90_added_sk,
          td.type_90_removed_sk,
          td.type_90_add_sub,      
          td.prem_sale_type,
          td.prem_adds,
          td.prem_removes,
          td.prem_sports_added,
          td.prem_movies_added,
          td.prem_sports_removed,
          td.prem_movies_removed,
          skg.fromdt as rtm_created_dt
     from uk_pre_customer_is.td_order_product_p5 td
     left outer join uk_inp_tds_chordiant_eod_is.cc_bsbretailbusiness ret 
      on (    ret.id = td.sale_retailer_id
          and ret.logically_deleted = 0) 
     left outer join (select userid,
                             skillgroup,
                             fromdt,
                             todt,
                             logically_deleted
                        from (select a.username as userid, 
                                     g.name as skillgroup, 
                                     ga.created as fromdt, 
                                     ifnull(ga.deleted,'9999-09-09') as todt,
                                     ga.logically_deleted as logically_deleted
                                from  uk_inp_tds_infomart_eod_is.cc_gidb_gcx_group_agent ga 
                                inner join uk_inp_tds_infomart_eod_is.cc_gidb_gc_agent a 
                                  on (    a.id = ga.agentid
                                      and a.logically_deleted = 0)
                                inner join uk_inp_tds_infomart_eod_is.cc_gidb_gc_group g 
                                  on (    g.id = ga.groupid
                                      and g.logically_deleted = 0)
                                where g.name like 'SKG%'
                                     ) foo
                     ) skg
      on (    td.order_created_by   = skg.userid
          and td.order_created_dt  >= skg.fromdt 
          and td.order_created_dt   < skg.todt
          and skg.logically_deleted = 0);


--------------------------------------------------------------------------------
--Populate td_order_product_p7 - DEDUP rows added from previous lookup. We take 
--the latest row from INFOMART in the case of having 2 open records.
--------------------------------------------------------------------------------
uk_pre_customer_is.td_order_product_p7:WRITE_TRUNCATE:
select order_id,
             order_number,
             order_created_dt,
             order_day_sk,
             order_last_updated_dt,
             order_created_by,
             order_communication_type,
             order_last_updated_by,
             contactor_role,
             contactor_id,
             portfolio_id,
             account_number,
             owning_cust_account_id,
             order_currency,
             account_currency_code,
             account_type_code,
             account_sub_type_code,
             dialled_number,
             interest_source_id,
             referring_customer_party_id,
             order_urn,
             sale_retailer_id,
             skill_group,
             rtm_level_1,
             rtm_level_2,
             rtm_level_3,
             bb_technology_code,
             lr_technology_code,
             st_technology_code,
             order_status,
             order_status_start_dt,
             order_status_reason_code,
             order_system_fix,
             order_sale_speed,
             order_sale_type,
             bundle_id,
             telephony_order_type,
             new_customer_flag,
             first_order_flag,
             type_1_saletype,
             type_1_adds,
             type_1_removes,
             type_1_added_sk,
             type_1_removed_sk,
             type_1_add_sub,
             type_2_saletype,
             type_2_adds,
             type_2_removes,
             type_2_added_sk,
             type_2_removed_sk,
             type_2_add_sub,
             type_3_saletype,
             type_3_adds,
             type_3_removes,
             type_3_added_sk,
             type_3_removed_sk,
             type_3_add_sub,
             type_4_saletype,
             type_4_adds,
             type_4_removes,
             type_4_added_sk,
             type_4_removed_sk,
             type_4_add_sub,
             type_5_saletype,
             type_5_adds,
             type_5_removes,
             type_5_added_sk,
             type_5_removed_sk,
             type_5_add_sub,
             type_6_saletype,
             type_6_adds,
             type_6_removes,
             type_6_added_sk,
             type_6_removed_sk,
             type_6_add_sub,
             type_7_saletype,
             type_7_adds,
             type_7_removes,
             type_7_added_sk,
             type_7_removed_sk,
             type_7_add_sub,
             type_8_saletype,
             type_8_adds,
             type_8_removes,
             type_8_added_sk,
             type_8_removed_sk,
             type_8_add_sub,
             type_9_saletype,
             type_9_adds,
             type_9_removes,
             type_9_added_sk,
             type_9_removed_sk,
             type_9_add_sub,
             type_10_saletype,
             type_10_adds,
             type_10_removes,
             type_10_added_sk,
             type_10_removed_sk,
             type_10_add_sub,
             type_11_saletype,
             type_11_adds,
             type_11_removes,
             type_11_added_sk,
             type_11_removed_sk,
             type_11_add_sub,
             type_12_saletype,
             type_12_adds,
             type_12_removes,
             type_12_added_sk,
             type_12_removed_sk,
             type_12_add_sub,
             type_13_saletype,
             type_13_adds,
             type_13_removes,
             type_13_added_sk,
             type_13_removed_sk,
             type_13_add_sub,
             type_14_saletype,
             type_14_adds,
             type_14_removes,
             type_14_added_sk,
             type_14_removed_sk,
             type_14_add_sub,
             type_15_saletype,
             type_15_adds,
             type_15_removes,
             type_15_added_sk,
             type_15_removed_sk,
             type_15_add_sub,
             type_16_saletype,
             type_16_adds,
             type_16_removes,
             type_16_added_sk,
             type_16_removed_sk,
             type_16_add_sub,
             type_17_saletype,
             type_17_adds,
             type_17_removes,
             type_17_added_sk,
             type_17_removed_sk,
             type_17_add_sub,
             type_18_saletype,
             type_18_adds,
             type_18_removes,
             type_18_added_sk,
             type_18_removed_sk,
             type_18_add_sub,
             type_19_saletype,
             type_19_adds,
             type_19_removes,
             type_19_added_sk,
             type_19_removed_sk,
             type_19_add_sub,
             type_20_saletype,
             type_20_adds,
             type_20_removes,
             type_20_added_sk,
             type_20_removed_sk,
             type_20_add_sub,
             type_21_saletype,
             type_21_adds,
             type_21_removes,
             type_21_added_sk,
             type_21_removed_sk,
             type_21_add_sub,
             type_22_saletype,
             type_22_adds,
             type_22_removes,
             type_22_added_sk,
             type_22_removed_sk,
             type_22_add_sub,
             type_23_saletype,
             type_23_adds,
             type_23_removes,
             type_23_added_sk,
             type_23_removed_sk,
             type_23_add_sub,
             type_24_saletype,
             type_24_adds,
             type_24_removes,
             type_24_added_sk,
             type_24_removed_sk,
             type_24_add_sub,
             type_25_saletype,
             type_25_adds,
             type_25_removes,
             type_25_added_sk,
             type_25_removed_sk,
             type_25_add_sub,
             type_26_saletype,
             type_26_adds,
             type_26_removes,
             type_26_added_sk,
             type_26_removed_sk,
             type_26_add_sub,
             type_27_saletype,
             type_27_adds,
             type_27_removes,
             type_27_added_sk,
             type_27_removed_sk,
             type_27_add_sub,
             type_28_saletype,
             type_28_adds,
             type_28_removes,
             type_28_added_sk,
             type_28_removed_sk,
             type_28_add_sub,
             type_29_saletype,
             type_29_adds,
             type_29_removes,
             type_29_added_sk,
             type_29_removed_sk,
             type_29_add_sub,
             type_30_saletype,
             type_30_adds,
             type_30_removes,
             type_30_added_sk,
             type_30_removed_sk,
             type_30_add_sub,
             type_31_saletype,
             type_31_adds,
             type_31_removes,
             type_31_added_sk,
             type_31_removed_sk,
             type_31_add_sub,
             type_32_saletype,
             type_32_adds,
             type_32_removes,
             type_32_added_sk,
             type_32_removed_sk,
             type_32_add_sub,
             type_33_saletype,
             type_33_adds,
             type_33_removes,
             type_33_added_sk,
             type_33_removed_sk,
             type_33_add_sub,
             type_34_saletype,
             type_34_adds,
             type_34_removes,
             type_34_added_sk,
             type_34_removed_sk,
             type_34_add_sub,
             type_35_saletype,
             type_35_adds,
             type_35_removes,
             type_35_added_sk,
             type_35_removed_sk,
             type_35_add_sub,
             type_36_saletype,
             type_36_adds,
             type_36_removes,
             type_36_added_sk,
             type_36_removed_sk,
             type_36_add_sub,
             type_37_saletype,
             type_37_adds,
             type_37_removes,
             type_37_added_sk,
             type_37_removed_sk,
             type_37_add_sub,
             type_38_saletype,
             type_38_adds,
             type_38_removes,
             type_38_added_sk,
             type_38_removed_sk,
             type_38_add_sub,
             type_39_saletype,
             type_39_adds,
             type_39_removes,
             type_39_added_sk,
             type_39_removed_sk,
             type_39_add_sub,
             type_40_saletype,
             type_40_adds,
             type_40_removes,
             type_40_added_sk,
             type_40_removed_sk,
             type_40_add_sub,
             type_41_saletype,
             type_41_adds,
             type_41_removes,
             type_41_added_sk,
             type_41_removed_sk,
             type_41_add_sub,
             type_42_saletype,
             type_42_adds,
             type_42_removes,
             type_42_added_sk,
             type_42_removed_sk,
             type_42_add_sub,
             type_43_saletype,
             type_43_adds,
             type_43_removes,
             type_43_added_sk,
             type_43_removed_sk,
             type_43_add_sub,
             type_44_saletype,
             type_44_adds,
             type_44_removes,
             type_44_added_sk,
             type_44_removed_sk,
             type_44_add_sub,
             type_45_saletype,
             type_45_adds,
             type_45_removes,
             type_45_added_sk,
             type_45_removed_sk,
             type_45_add_sub,
             type_46_saletype,
             type_46_adds,
             type_46_removes,
             type_46_added_sk,
             type_46_removed_sk,
             type_46_add_sub,
             type_47_saletype,
             type_47_adds,
             type_47_removes,
             type_47_added_sk,
             type_47_removed_sk,
             type_47_add_sub,
             type_48_saletype,
             type_48_adds,
             type_48_removes,
             type_48_added_sk,
             type_48_removed_sk,
             type_48_add_sub,
             type_49_saletype,
             type_49_adds,
             type_49_removes,
             type_49_added_sk,
             type_49_removed_sk,
             type_49_add_sub,
             type_50_saletype,
             type_50_adds,
             type_50_removes,
             type_50_added_sk,
             type_50_removed_sk,
             type_50_add_sub,
             type_51_saletype,
             type_51_adds,
             type_51_removes,
             type_51_added_sk,
             type_51_removed_sk,
             type_51_add_sub,
             type_52_saletype,
             type_52_adds,
             type_52_removes,
             type_52_added_sk,
             type_52_removed_sk,
             type_52_add_sub,
             type_53_saletype,
             type_53_adds,
             type_53_removes,
             type_53_added_sk,
             type_53_removed_sk,
             type_53_add_sub,
             type_54_saletype,
             type_54_adds,
             type_54_removes,
             type_54_added_sk,
             type_54_removed_sk,
             type_54_add_sub,
             type_55_saletype,
             type_55_adds,
             type_55_removes,
             type_55_added_sk,
             type_55_removed_sk,
             type_55_add_sub,
             type_56_saletype,
             type_56_adds,
             type_56_removes,
             type_56_added_sk,
             type_56_removed_sk,
             type_56_add_sub,
             type_57_saletype,
             type_57_adds,
             type_57_removes,
             type_57_added_sk,
             type_57_removed_sk,
             type_57_add_sub,
             type_58_saletype,
             type_58_adds,
             type_58_removes,
             type_58_added_sk,
             type_58_removed_sk,
             type_58_add_sub,
             type_59_saletype,
             type_59_adds,
             type_59_removes,
             type_59_added_sk,
             type_59_removed_sk,
             type_59_add_sub,
             type_60_saletype,
             type_60_adds,
             type_60_removes,
             type_60_added_sk,
             type_60_removed_sk,
             type_60_add_sub,
             type_61_saletype,
             type_61_adds,
             type_61_removes,
             type_61_added_sk,
             type_61_removed_sk,
             type_61_add_sub,
             type_62_saletype,
             type_62_adds,
             type_62_removes,
             type_62_added_sk,
             type_62_removed_sk,
             type_62_add_sub,
             type_63_saletype,
             type_63_adds,
             type_63_removes,
             type_63_added_sk,
             type_63_removed_sk,
             type_63_add_sub,
             type_64_saletype,
             type_64_adds,
             type_64_removes,
             type_64_added_sk,
             type_64_removed_sk,
             type_64_add_sub,
             type_65_saletype,
             type_65_adds,
             type_65_removes,
             type_65_added_sk,
             type_65_removed_sk,
             type_65_add_sub,
             type_66_saletype,
             type_66_adds,
             type_66_removes,
             type_66_added_sk,
             type_66_removed_sk,
             type_66_add_sub,
             type_67_saletype,
             type_67_adds,
             type_67_removes,
             type_67_added_sk,
             type_67_removed_sk,
             type_67_add_sub,
             type_68_saletype,
             type_68_adds,
             type_68_removes,
             type_68_added_sk,
             type_68_removed_sk,
             type_68_add_sub,
             type_69_saletype,
             type_69_adds,
             type_69_removes,
             type_69_added_sk,
             type_69_removed_sk,
             type_69_add_sub,
             type_70_saletype,
             type_70_adds,
             type_70_removes,
             type_70_added_sk,
             type_70_removed_sk,
             type_70_add_sub,
             type_71_saletype,
             type_71_adds,
             type_71_removes,
             type_71_added_sk,
             type_71_removed_sk,
             type_71_add_sub,
             type_72_saletype,
             type_72_adds,
             type_72_removes,
             type_72_added_sk,
             type_72_removed_sk,
             type_72_add_sub,
             type_73_saletype,
             type_73_adds,
             type_73_removes,
             type_73_added_sk,
             type_73_removed_sk,
             type_73_add_sub,
             type_74_saletype ,
             type_74_adds,
             type_74_removes,
             type_74_added_sk,
             type_74_removed_sk,
             type_74_add_sub,
             type_75_saletype,
             type_75_adds,
             type_75_removes,
             type_75_added_sk,
             type_75_removed_sk,
             type_75_add_sub,
             type_76_saletype,
             type_76_adds,
             type_76_removes,
             type_76_added_sk,
             type_76_removed_sk,
             type_76_add_sub,
             type_77_saletype,
             type_77_adds,
             type_77_removes,
             type_77_added_sk,
             type_77_removed_sk,
             type_77_add_sub,
             type_78_saletype ,
             type_78_adds,
             type_78_removes,
             type_78_added_sk,
             type_78_removed_sk,
             type_78_add_sub,
             type_79_saletype ,
             type_79_adds,
             type_79_removes,
             type_79_added_sk,
             type_79_removed_sk,
             type_79_add_sub,
             type_80_saletype,
             type_80_adds,
             type_80_removes,
             type_80_added_sk,
             type_80_removed_sk,
             type_80_add_sub,
             type_81_saletype,
             type_81_adds,
             type_81_removes,
             type_81_added_sk,
             type_81_removed_sk,
             type_81_add_sub,
             type_82_saletype,
             type_82_adds,
             type_82_removes,
             type_82_added_sk,
             type_82_removed_sk,
             type_82_add_sub,
             type_83_saletype,
             type_83_adds,
             type_83_removes,
             type_83_added_sk,
             type_83_removed_sk,
             type_83_add_sub,
             type_84_saletype,
             type_84_adds,
             type_84_removes,
             type_84_added_sk,
             type_84_removed_sk,
             type_84_add_sub,
             type_85_saletype,
             type_85_adds,
             type_85_removes,
             type_85_added_sk,
             type_85_removed_sk,
             type_85_add_sub,
             type_86_saletype,
             type_86_adds,
             type_86_removes,
             type_86_added_sk,
             type_86_removed_sk,
             type_86_add_sub,
             type_87_saletype,
             type_87_adds,
             type_87_removes,
             type_87_added_sk,
             type_87_removed_sk,
             type_87_add_sub,
             type_88_saletype, 
             type_88_adds,
             type_88_removes,
             type_88_added_sk,
             type_88_removed_sk,
             type_88_add_sub,
             type_89_saletype,
             type_89_adds,
             type_89_removes,
             type_89_added_sk,
             type_89_removed_sk,
             type_89_add_sub,
             type_90_saletype,
             type_90_adds,
             type_90_removes,
             type_90_added_sk,
             type_90_removed_sk,
             type_90_add_sub,      
             prem_sale_type,
             prem_adds,
             prem_removes,
             prem_sports_added,
             prem_movies_added,
             prem_sports_removed,
             prem_movies_removed,
             rn
        from (select order_id,
                    order_number,
                    order_created_dt,
                    order_day_sk,
                    order_last_updated_dt,
                    order_created_by,
                    order_communication_type,
                    order_last_updated_by,
                    contactor_role,
                    contactor_id,
                    portfolio_id,
                    account_number,
                    owning_cust_account_id,
                    order_currency,
                    account_currency_code,
                    account_type_code,
                    account_sub_type_code,
                    dialled_number,
                    interest_source_id,
                    referring_customer_party_id,
                    order_urn,
                    sale_retailer_id,
                    skill_group,
                    rtm_level_1,
                    rtm_level_2,
                    rtm_level_3,
                    bb_technology_code,
                    lr_technology_code,
                    st_technology_code,
                    order_status,
                    order_status_start_dt,
                    order_status_reason_code,
                    order_system_fix,
                    order_sale_speed,
                    order_sale_type,
                    bundle_id,
                    telephony_order_type,
                    new_customer_flag,
                    first_order_flag,
                    type_1_saletype,
                    type_1_adds,
                    type_1_removes,
                    type_1_added_sk,
                    type_1_removed_sk,
                    type_1_add_sub,
                    type_2_saletype,
                    type_2_adds,
                    type_2_removes,
                    type_2_added_sk,
                    type_2_removed_sk,
                    type_2_add_sub,
                    type_3_saletype,
                    type_3_adds,
                    type_3_removes,
                    type_3_added_sk,
                    type_3_removed_sk,
                    type_3_add_sub,
                    type_4_saletype,
                    type_4_adds,
                    type_4_removes,
                    type_4_added_sk,
                    type_4_removed_sk,
                    type_4_add_sub,
                    type_5_saletype,
                    type_5_adds,
                    type_5_removes,
                    type_5_added_sk,
                    type_5_removed_sk,
                    type_5_add_sub,
                    type_6_saletype,
                    type_6_adds,
                    type_6_removes,
                    type_6_added_sk,
                    type_6_removed_sk,
                    type_6_add_sub,
                    type_7_saletype,
                    type_7_adds,
                    type_7_removes,
                    type_7_added_sk,
                    type_7_removed_sk,
                    type_7_add_sub,
                    type_8_saletype,
                    type_8_adds,
                    type_8_removes,
                    type_8_added_sk,
                    type_8_removed_sk,
                    type_8_add_sub,
                    type_9_saletype,
                    type_9_adds,
                    type_9_removes,
                    type_9_added_sk,
                    type_9_removed_sk,
                    type_9_add_sub,
                    type_10_saletype,
                    type_10_adds,
                    type_10_removes,
                    type_10_added_sk,
                    type_10_removed_sk,
                    type_10_add_sub,
                    type_11_saletype,
                    type_11_adds,
                    type_11_removes,
                    type_11_added_sk,
                    type_11_removed_sk,
                    type_11_add_sub,
                    type_12_saletype,
                    type_12_adds,
                    type_12_removes,
                    type_12_added_sk,
                    type_12_removed_sk,
                    type_12_add_sub,
                    type_13_saletype,
                    type_13_adds,
                    type_13_removes,
                    type_13_added_sk,
                    type_13_removed_sk,
                    type_13_add_sub,
                    type_14_saletype,
                    type_14_adds,
                    type_14_removes,
                    type_14_added_sk,
                    type_14_removed_sk,
                    type_14_add_sub,
                    type_15_saletype,
                    type_15_adds,
                    type_15_removes,
                    type_15_added_sk,
                    type_15_removed_sk,
                    type_15_add_sub,
                    type_16_saletype,
                    type_16_adds,
                    type_16_removes,
                    type_16_added_sk,
                    type_16_removed_sk,
                    type_16_add_sub,
                    type_17_saletype,
                    type_17_adds,
                    type_17_removes,
                    type_17_added_sk,
                    type_17_removed_sk,
                    type_17_add_sub,
                    type_18_saletype,
                    type_18_adds,
                    type_18_removes,
                    type_18_added_sk,
                    type_18_removed_sk,
                    type_18_add_sub,
                    type_19_saletype,
                    type_19_adds,
                    type_19_removes,
                    type_19_added_sk,
                    type_19_removed_sk,
                    type_19_add_sub,
                    type_20_saletype,
                    type_20_adds,
                    type_20_removes,
                    type_20_added_sk,
                    type_20_removed_sk,
                    type_20_add_sub,
                    type_21_saletype,
                    type_21_adds,
                    type_21_removes,
                    type_21_added_sk,
                    type_21_removed_sk,
                    type_21_add_sub,
                    type_22_saletype,
                    type_22_adds,
                    type_22_removes,
                    type_22_added_sk,
                    type_22_removed_sk,
                    type_22_add_sub,
                    type_23_saletype,
                    type_23_adds,
                    type_23_removes,
                    type_23_added_sk,
                    type_23_removed_sk,
                    type_23_add_sub,
                    type_24_saletype,
                    type_24_adds,
                    type_24_removes,
                    type_24_added_sk,
                    type_24_removed_sk,
                    type_24_add_sub,
                    type_25_saletype,
                    type_25_adds,
                    type_25_removes,
                    type_25_added_sk,
                    type_25_removed_sk,
                    type_25_add_sub,
                    type_26_saletype,
                    type_26_adds,
                    type_26_removes,
                    type_26_added_sk,
                    type_26_removed_sk,
                    type_26_add_sub,
                    type_27_saletype,
                    type_27_adds,
                    type_27_removes,
                    type_27_added_sk,
                    type_27_removed_sk,
                    type_27_add_sub,
                    type_28_saletype,
                    type_28_adds,
                    type_28_removes,
                    type_28_added_sk,
                    type_28_removed_sk,
                    type_28_add_sub,
                    type_29_saletype,
                    type_29_adds,
                    type_29_removes,
                    type_29_added_sk,
                    type_29_removed_sk,
                    type_29_add_sub,
                    type_30_saletype,
                    type_30_adds,
                    type_30_removes,
                    type_30_added_sk,
                    type_30_removed_sk,
                    type_30_add_sub,
                    type_31_saletype,
                    type_31_adds,
                    type_31_removes,
                    type_31_added_sk,
                    type_31_removed_sk,
                    type_31_add_sub,
                    type_32_saletype,
                    type_32_adds,
                    type_32_removes,
                    type_32_added_sk,
                    type_32_removed_sk,
                    type_32_add_sub,
                    type_33_saletype,
                    type_33_adds,
                    type_33_removes,
                    type_33_added_sk,
                    type_33_removed_sk,
                    type_33_add_sub,
                    type_34_saletype,
                    type_34_adds,
                    type_34_removes,
                    type_34_added_sk,
                    type_34_removed_sk,
                    type_34_add_sub,
                    type_35_saletype,
                    type_35_adds,
                    type_35_removes,
                    type_35_added_sk,
                    type_35_removed_sk,
                    type_35_add_sub,
                    type_36_saletype,
                    type_36_adds,
                    type_36_removes,
                    type_36_added_sk,
                    type_36_removed_sk,
                    type_36_add_sub,
                    type_37_saletype,
                    type_37_adds,
                    type_37_removes,
                    type_37_added_sk,
                    type_37_removed_sk,
                    type_37_add_sub,
                    type_38_saletype,
                    type_38_adds,
                    type_38_removes,
                    type_38_added_sk,
                    type_38_removed_sk,
                    type_38_add_sub,
                    type_39_saletype,
                    type_39_adds,
                    type_39_removes,
                    type_39_added_sk,
                    type_39_removed_sk,
                    type_39_add_sub,
                    type_40_saletype,
                    type_40_adds,
                    type_40_removes,
                    type_40_added_sk,
                    type_40_removed_sk,
                    type_40_add_sub,
                    type_41_saletype,
                    type_41_adds,
                    type_41_removes,
                    type_41_added_sk,
                    type_41_removed_sk,
                    type_41_add_sub,
                    type_42_saletype,
                    type_42_adds,
                    type_42_removes,
                    type_42_added_sk,
                    type_42_removed_sk,
                    type_42_add_sub,
                    type_43_saletype,
                    type_43_adds,
                    type_43_removes,
                    type_43_added_sk,
                    type_43_removed_sk,
                    type_43_add_sub,
                    type_44_saletype,
                    type_44_adds,
                    type_44_removes,
                    type_44_added_sk,
                    type_44_removed_sk,
                    type_44_add_sub,
                    type_45_saletype,
                    type_45_adds,
                    type_45_removes,
                    type_45_added_sk,
                    type_45_removed_sk,
                    type_45_add_sub,
                    type_46_saletype,
                    type_46_adds,
                    type_46_removes,
                    type_46_added_sk,
                    type_46_removed_sk,
                    type_46_add_sub,
                    type_47_saletype,
                    type_47_adds,
                    type_47_removes,
                    type_47_added_sk,
                    type_47_removed_sk,
                    type_47_add_sub,
                    type_48_saletype,
                    type_48_adds,
                    type_48_removes,
                    type_48_added_sk,
                    type_48_removed_sk,
                    type_48_add_sub,
                    type_49_saletype,
                    type_49_adds,
                    type_49_removes,
                    type_49_added_sk,
                    type_49_removed_sk,
                    type_49_add_sub,
                    type_50_saletype,
                    type_50_adds,
                    type_50_removes,
                    type_50_added_sk,
                    type_50_removed_sk,
                    type_50_add_sub,
                    type_51_saletype,
                    type_51_adds,
                    type_51_removes,
                    type_51_added_sk,
                    type_51_removed_sk,
                    type_51_add_sub,
                    type_52_saletype,
                    type_52_adds,
                    type_52_removes,
                    type_52_added_sk,
                    type_52_removed_sk,
                    type_52_add_sub,
                    type_53_saletype,
                    type_53_adds,
                    type_53_removes,
                    type_53_added_sk,
                    type_53_removed_sk,
                    type_53_add_sub,
                    type_54_saletype,
                    type_54_adds,
                    type_54_removes,
                    type_54_added_sk,
                    type_54_removed_sk,
                    type_54_add_sub,
                    type_55_saletype,
                    type_55_adds,
                    type_55_removes,
                    type_55_added_sk,
                    type_55_removed_sk,
                    type_55_add_sub,
                    type_56_saletype,
                    type_56_adds,
                    type_56_removes,
                    type_56_added_sk,
                    type_56_removed_sk,
                    type_56_add_sub,
                    type_57_saletype,
                    type_57_adds,
                    type_57_removes,
                    type_57_added_sk,
                    type_57_removed_sk,
                    type_57_add_sub,
                    type_58_saletype,
                    type_58_adds,
                    type_58_removes,
                    type_58_added_sk,
                    type_58_removed_sk,
                    type_58_add_sub,
                    type_59_saletype,
                    type_59_adds,
                    type_59_removes,
                    type_59_added_sk,
                    type_59_removed_sk,
                    type_59_add_sub,
                    type_60_saletype,
                    type_60_adds,
                    type_60_removes,
                    type_60_added_sk,
                    type_60_removed_sk,
                    type_60_add_sub,
                    type_61_saletype,
                    type_61_adds,
                    type_61_removes,
                    type_61_added_sk,
                    type_61_removed_sk,
                    type_61_add_sub,
                    type_62_saletype,
                    type_62_adds,
                    type_62_removes,
                    type_62_added_sk,
                    type_62_removed_sk,
                    type_62_add_sub,
                    type_63_saletype,
                    type_63_adds,
                    type_63_removes,
                    type_63_added_sk,
                    type_63_removed_sk,
                    type_63_add_sub,
                    type_64_saletype,
                    type_64_adds,
                    type_64_removes,
                    type_64_added_sk,
                    type_64_removed_sk,
                    type_64_add_sub,
                    type_65_saletype,
                    type_65_adds,
                    type_65_removes,
                    type_65_added_sk,
                    type_65_removed_sk,
                    type_65_add_sub,
                    type_66_saletype,
                    type_66_adds,
                    type_66_removes,
                    type_66_added_sk,
                    type_66_removed_sk,
                    type_66_add_sub,
                    type_67_saletype,
                    type_67_adds,
                    type_67_removes,
                    type_67_added_sk,
                    type_67_removed_sk,
                    type_67_add_sub,
                    type_68_saletype,
                    type_68_adds,
                    type_68_removes,
                    type_68_added_sk,
                    type_68_removed_sk,
                    type_68_add_sub,
                    type_69_saletype,
                    type_69_adds,
                    type_69_removes,
                    type_69_added_sk,
                    type_69_removed_sk,
                    type_69_add_sub,
                    type_70_saletype,
                    type_70_adds,
                    type_70_removes,
                    type_70_added_sk,
                    type_70_removed_sk,
                    type_70_add_sub,
                    type_71_saletype,
                    type_71_adds,
                    type_71_removes,
                    type_71_added_sk,
                    type_71_removed_sk,
                    type_71_add_sub,
                    type_72_saletype,
                    type_72_adds,
                    type_72_removes,
                    type_72_added_sk,
                    type_72_removed_sk,
                    type_72_add_sub,
                    type_73_saletype,
                    type_73_adds,
                    type_73_removes,
                    type_73_added_sk,
                    type_73_removed_sk,
                    type_73_add_sub,
                    type_74_saletype ,
                    type_74_adds,
                    type_74_removes,
                    type_74_added_sk,
                    type_74_removed_sk,
                    type_74_add_sub,
                    type_75_saletype,
                    type_75_adds,
                    type_75_removes,
                    type_75_added_sk,
                    type_75_removed_sk,
                    type_75_add_sub,
                    type_76_saletype,
                    type_76_adds,
                    type_76_removes,
                    type_76_added_sk,
                    type_76_removed_sk,
                    type_76_add_sub,
                    type_77_saletype,
                    type_77_adds,
                    type_77_removes,
                    type_77_added_sk,
                    type_77_removed_sk,
                    type_77_add_sub,
                    type_78_saletype ,
                    type_78_adds,
                    type_78_removes,
                    type_78_added_sk,
                    type_78_removed_sk,
                    type_78_add_sub,
                    type_79_saletype ,
                    type_79_adds,
                    type_79_removes,
                    type_79_added_sk,
                    type_79_removed_sk,
                    type_79_add_sub,
                    type_80_saletype,
                    type_80_adds,
                    type_80_removes,
                    type_80_added_sk,
                    type_80_removed_sk,
                    type_80_add_sub,
                    type_81_saletype,
                    type_81_adds,
                    type_81_removes,
                    type_81_added_sk,
                    type_81_removed_sk,
                    type_81_add_sub,
                    type_82_saletype,
                    type_82_adds,
                    type_82_removes,
                    type_82_added_sk,
                    type_82_removed_sk,
                    type_82_add_sub,
                    type_83_saletype,
                    type_83_adds,
                    type_83_removes,
                    type_83_added_sk,
                    type_83_removed_sk,
                    type_83_add_sub,
                    type_84_saletype,
                    type_84_adds,
                    type_84_removes,
                    type_84_added_sk,
                    type_84_removed_sk,
                    type_84_add_sub,
                    type_85_saletype,
                    type_85_adds,
                    type_85_removes,
                    type_85_added_sk,
                    type_85_removed_sk,
                    type_85_add_sub,
                    type_86_saletype,
                    type_86_adds,
                    type_86_removes,
                    type_86_added_sk,
                    type_86_removed_sk,
                    type_86_add_sub,
                    type_87_saletype,
                    type_87_adds,
                    type_87_removes,
                    type_87_added_sk,
                    type_87_removed_sk,
                    type_87_add_sub,
                    type_88_saletype, 
                    type_88_adds,
                    type_88_removes,
                    type_88_added_sk,
                    type_88_removed_sk,
                    type_88_add_sub,
                    type_89_saletype,
                    type_89_adds,
                    type_89_removes,
                    type_89_added_sk,
                    type_89_removed_sk,
                    type_89_add_sub,
                    type_90_saletype,
                    type_90_adds,
                    type_90_removes,
                    type_90_added_sk,
                    type_90_removed_sk,
                    type_90_add_sub,      
                    prem_sale_type,
                    prem_adds,
                    prem_removes,
                    prem_sports_added,
                    prem_movies_added,
                    prem_sports_removed,
                    prem_movies_removed,
                    row_number() over (partition by order_id
                                          order by  rtm_created_dt desc) as rn
               from uk_pre_customer_is.td_order_product_p6) foo
  where foo.rn = 1;
  
  
